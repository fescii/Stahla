{
  "name": "Stahla_Services_Callback_Flow_v5_Completed",
  "nodes": [
    {
      "id": "start_call",
      "type": "Default",
      "data": {
        "name": "Start Call - Confirm Good Time",
        "prompt": "Hi, this is Stahla Services following up on your recent inquiry. I’d like to confirm a few details with you. Is now a convenient time to talk?",
        "isStart": true,
        "extractVars": [
          [
            "is_now_good_time",
            "boolean",
            "Whether now is a good time to talk. Capture true or false."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "ask_best_time_to_call",
      "type": "Default",
      "data": {
        "name": "Ask Best Time to Call Back",
        "prompt": "Okay, no problem. When would be a better time for me to call you back?",
        "extractVars": [
          [
            "best_time_to_call_back",
            "string",
            "Preferred callback time if now isn't good (e.g., 'tomorrow morning', 'around 3 PM')."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "end_call_reschedule",
      "type": "End Call",
      "data": {
        "name": "End Call - Reschedule",
        "prompt": "Thanks for letting me know. I'll make a note to have us call you back {{best_time_to_call_back | default: 'at a more convenient time'}}. Have a great day!"
      }
    },
    {
      "id": "global_handle_user_question_kb",
      "type": "Knowledge Base",
      "data": {
        "name": "Global: Answer User Question from KB",
        "isGlobal": true,
        "globalLabel": "User has a general question or needs help or asks something off-script",
        "knowledgeBase": "Stahla Services (Stahla Rentals) - Knowledge Base\nSummary\nStahla Services, now known simply as Stahla, is a Nebraska-based, family-owned company specializing in luxury portable restroom and shower trailer rentals. Founded in 2014 by Grant and Erin Stahla, the company emphasizes hospitality, cleanliness, and a faith-driven commitment to customer care. Serving 17 states across the Midwest and Southwest, Stahla provides high-end sanitation solutions for events, construction sites, and emergency responses. Their trailers feature amenities like climate control, flushing toilets, and running water, aiming to offer a dignified and comfortable experience. With a focus on exceptional service and community values, Stahla has grown into a trusted provider in the portable sanitation industry.\nCompany Overview\nLegal Name: Stahla Services, LLC\nFounded: 2014\nFounders: Grant Stahla (CEO) & Erin Stahla (Co-Owner)\nCore Values: Family-run, faith-driven, customer-first service, Midwest work ethic\nServices Offered\nRestroom Trailer Rentals: Options range from 2-stall to 10-stall configurations. Examples: '2 Stall Restroom Trailer (Luxury)', '4 Stall Restroom Trailer (Standard)', '8 Stall Restroom Trailer (ADA Combo)'.\nADA Restroom Trailers: Fully compliant with Americans with Disabilities Act (ADA) standards. Include ramps, handrails, and spacious interiors.\nShower Trailer Rentals: Provide private, lockable shower stalls with hot water. Examples: '3 Stall Shower Trailer', '8 Stall Shower/Restroom Combo Trailer'.\nLaundry Trailer Rentals: Mobile units equipped with commercial-grade washers and dryers.\nPorta Potty Rentals: Standard, budget-friendly option. Available in basic, deluxe, or hand washing-equipped models. Includes ADA Porta Potty options.\nGenerator Rentals: Various sizes available, e.g., '3kW Generator', '7kW Generator'.\nOther Services: Holding tanks, fresh water delivery, regular servicing/pump-outs, cleaning.\nService Area\nServes 17 U.S. states: Arkansas (AR), Colorado (CO), Illinois (IL), Iowa (IA), Kansas (KS), Louisiana (LA), Minnesota (MN), Missouri (MO), Montana (MT), Nebraska (NE), New Mexico (NM), North Dakota (ND), Oklahoma (OK), South Dakota (SD), Texas (TX), Wisconsin (WI), Wyoming (WY)\nHeadquarters and Locations\nPrimary HQ: Omaha, Nebraska\nMain Address: 16902 South 180th Street, Suite 200, Springfield, NE 68059\nOther Office Locations:\nLincoln, NE – 420 W A St, Suite 200\nGretna, NE – 21824 Williams Circle\nSmithville, MO – 17609 HH Lake Road\nDenver, CO – 1340 Umatilla St\nContact Information\nPhone: (844) 900-3190\nEmail: [email protected]\nBusiness Hours:\nMon–Fri: 8 AM–5 PM\nSat: 8 AM–5 PM\nSun: Closed\nWebsite: https://stahla.com/\nProduct List (Examples - refer to full product sheet for all models):\n2 Stall Restroom Trailer (Luxury), 2 Stall Restroom Trailer (Standard), 3 Stall Restroom Trailer (Luxury), 4 Stall Restroom Trailer (Standard), 4 Stall Restroom Trailer (ADA Compliant), 5 Stall Restroom Trailer, 6 Stall Restroom Trailer, 8 Stall Restroom Trailer, 10 Stall Restroom Trailer, ADA Porta Potty, Standard Porta Potty, Deluxe Porta Potty, Hand wash Station (Porta Potty Addon), 3 Stall Shower Trailer, 8 Stall Shower Trailer, Laundry Trailer (8 Washer/Dryer), 3kW Generator, 7kW Generator.\nUsage Types for Quotes: event, commercial, construction, disaster_relief, other.",
        "prompt": "The user asked: {{lastUserMessage}}. Please find the answer in the knowledge base. If the question is about pricing or specific availability not in the KB, state that you'll need to gather more details or that it will be covered in the quote. After answering, return to the conversation where you left off.",
        "modelOptions": {
          "temperature": 0.6,
          "interruptionThreshold": 0.8
        }
      }
    },
    {
      "id": "confirm_name",
      "type": "Default",
      "data": {
        "name": "Confirm Contact Name",
        "prompt": "Great! Just to confirm, I have {{request_data.firstname}} {{request_data.lastname}} as your name? If not, please tell me your full name.",
        "extractVars": [
          [
            "contact_name",
            "string",
            "The confirmed or corrected full name of the contact person. If they confirm the existing name from {{request_data.firstname}} {{request_data.lastname}}, concatenate those values. Otherwise, capture the name they provide."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "confirm_email",
      "type": "Default",
      "data": {
        "name": "Confirm or Collect Email",
        "prompt": "Thanks, {{contact_name}}. Can you confirm your email address? We might have {{request_data.email}}. If that's not correct or you'd like to use a different one, please tell me your email address.",
        "extractVars": [
          [
            "contact_email",
            "string",
            "If they confirm with words like 'yes', 'correct', 'that's right', 'that's correct', or similar, extract the value from {{request_data.email}}. If they provide a new email, extract exactly what they say."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "confirm_phone",
      "type": "Default",
      "data": {
        "name": "Confirm or Collect Phone",
        "prompt": "And is the best phone number to reach you still {{request_data.phone | default: 'the number I called'}}? If not, please provide the best number.",
        "extractVars": [
          [
            "phone_number",
            "string",
            "If they confirm with words like 'yes', 'correct', 'that's right', or similar, extract the value from {{request_data.phone}}. If they provide a new number, extract exactly what they say."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "confirm_company",
      "type": "Default",
      "data": {
        "name": "Confirm or Collect Company Name",
        "prompt": "And is this order related to any company? If not, just say 'none'. If you have a company name, please provide it.",
        "extractVars": [
          [
            "company_name",
            "string",
            "The confirmed or provided company name. If they say 'none' or personal, set to 'none'. Otherwise, capture the company name they provide."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "confirm_address",
      "type": "Default",
      "data": {
        "name": "Confirm or Collect Address",
        "prompt": "Thank you, {{contact_name}}. Could you please confirm the address for this order? Our records might show it as {{request_data.event_address | default: 'the address we have on file, or please provide the full address'}}. If that's not correct, or if no address is on file, please provide the full address, including street, city, state, and zip code.",
        "extractVars": [
          [
            "delivery_location",
            "string",
            "If they confirm with words like 'yes', 'correct', 'that one is correct', or similar, extract the value from {{request_data.event_address}}. If they provide a new address, extract exactly what they say."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "delivery_address_type_node",
      "type": "Default",
      "data": {
        "name": "Confirm Delivery Address Type",
        "prompt": "Can you tell me what type of location this is for delivery at {{delivery_location}}? Is it a business, a residence, or something else?",
        "extractVars": [
          [
            "location_type",
            "string",
            "Type of location (business, residence, other)."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 200
        }
      }
    },
    {
      "id": "trigger_background_location_processing_node",
      "type": "Webhook",
      "data": {
        "name": "Trigger Background Location Lookup",
        "prompt": "Thanks for confirming the address. Let me verify your location and check our service area coverage.",
        "url": "https://nicely-thorough-monster.ngrok-free.app/api/v1/webhook/location/lookup/sync",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer 7%FRtf@34hi"
        },
        "body": "{\"delivery_location\": \"{{delivery_location}}\"}",
        "timeout": 15,
        "retries": 2,
        "response_data": [
          {
            "name": "location_api_success",
            "data": "$.success"
          },
          {
            "name": "lookup_success",
            "data": "$.success"
          },
          {
            "name": "lookup_message",
            "data": "$.data.message"
          },
          {
            "name": "api_delivery_location",
            "data": "$.data.distance_result.delivery_location"
          },
          {
            "name": "is_in_service_area",
            "data": "$.data.distance_result.within_service_area"
          },
          {
            "name": "api_error_message",
            "data": "$.error_message"
          }
        ],
        "speechDuringWebhook": {
          "enabled": true,
          "text": "One moment while I verify your location and check our service area coverage."
        },
        "afterWebhookPrompt": "Perfect! I've verified your location: {{api_delivery_location}}.",
        "pathwayRouting": [
          {
            "condition": "{{location_api_success}} is true and {{is_in_service_area}} is true",
            "nextNode": "determine_order_category"
          },
          {
            "condition": "{{location_api_success}} is true and {{is_in_service_area}} is false",
            "nextNode": "handle_out_of_service_area"
          },
          {
            "condition": "{{location_api_success}} is false",
            "nextNode": "api_error_location_tool"
          },
          {
            "condition": "API Request Completion (Default)",
            "nextNode": "determine_order_category"
          }
        ]
      }
    },
    {
      "id": "handle_out_of_service_area",
      "type": "Default",
      "data": {
        "name": "Handle Out of Service Area",
        "prompt": "I understand this may be disappointing, but your location at {{api_delivery_location}} is outside our current service coverage area. However, we're always expanding our services and sometimes work with trusted partner providers. Would you like me to see if we can connect you with a qualified partner in your area who might be able to help?",
        "extractVars": [
          [
            "offer_referral_consent",
            "boolean",
            "Does the user want to be referred to a partner provider? (true for yes, false for no)"
          ]
        ]
      }
    },
    {
      "id": "wants_referral_node",
      "type": "End Call",
      "data": {
        "name": "Closing - Out of Service with Referral",
        "prompt": "Okay, I've noted that. We'll check for potential partners and reach out if we find a suitable referral. Thank you for contacting Stahla Services. Have a great day!"
      }
    },
    {
      "id": "no_referral_node",
      "type": "End Call",
      "data": {
        "name": "Closing - Out of Service No Referral",
        "prompt": "Understood. Sorry we couldn't assist directly this time. Thank you for considering Stahla Services. Have a great day!"
      }
    },
    {
      "id": "determine_order_category",
      "type": "Default",
      "data": {
        "name": "Determine Order Category (Path A Start)",
        "prompt": "Now that we've confirmed the location is in our service area, let's talk about your {{request_data.service_needed | default: 'Product'}} specific needs. Is this order primarily for an Event, Construction, Disaster Relief, a Construction Company, or a Facility?",
        "extractVars": [
          [
            "project_category",
            "string",
            "The user's confirmed primary project category (Event, Construction, Disaster Relief, Construction Company, Facility)."
          ],
          [
            "usage_type",
            "string",
            "Extract the lowercase usage type: 'event' for Event, 'construction' for Construction/Construction Company, 'disaster relief' for Disaster Relief, 'facility' for Facility."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "determine_product_type",
      "type": "Default",
      "data": {
        "name": "Confirm Product Type",
        "prompt": "Great! Just to confirm, you requested {{request_data.service_needed | default: 'Product'}}. Is that correct? If not, please let me know what type of product you are primarily interested in, we have a variety of options available, including; a Porta Potty, Restroom Trailer, Shower Trailer, Combo Trailer, or another Specialty Trailer?",
        "extractVars": [
          [
            "product_type",
            "string",
            "The user's confirmed primary product type focus (e.g., 'Porta Potty', 'Restroom Trailer', 'Shower Trailer', 'Combo Trailer', 'Specialty Trailer'). If they say 'other', capture that as well."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_event_duration_days",
      "type": "Default",
      "data": {
        "name": "Ask Event Duration (Days)",
        "prompt": "For your {{project_category}}, how many days will it last?",
        "extractVars": [
          [
            "event_duration_days",
            "number",
            "Number of days the event will last, if less then 1 day, set to 1."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_total_hours",
      "type": "Default",
      "data": {
        "name": "Ask Total Hours (if >1 day)",
        "prompt": "Since it's a multi-day event ({{event_duration_days}} days), how many total hours a day will the {{product_type | default: 'units'}} be needed across all days?",
        "extractVars": [
          [
            "event_total_hours_a_day",
            "number",
            "Total hours units will be needed per day for the multi-day event."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_discuss_extra_services_multi_day_long_hours",
      "type": "Default",
      "data": {
        "name": "Discuss Extra Services (Multi-day, >=8hrs)",
        "prompt": "Okay, for an event running {{event_duration_days}} days with {{event_total_hours_a_day}} hours a day of usage, we might need to discuss extra services like waste tank pumping, fresh water fill, cleaning, and restocking?",
        "extractVars": [
          [
            "sa_accepts_discussion_extra_services",
            "boolean",
            "User acknowledges or is open to discussing extra servicing. (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_for_servicing_gaps",
      "type": "Default",
      "data": {
        "name": "Ask for Servicing Gaps",
        "prompt": "Will there be gaps between days for such servicing?",
        "extractVars": [
          [
            "sa_gaps_for_servicing",
            "boolean",
            "Will there be gaps between event days for servicing? (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_attendees",
      "type": "Default",
      "data": {
        "name": "Ask Number of Attendees",
        "prompt": "Approximately how many people will attend the event on its busiest day?",
        "extractVars": [
          [
            "attendees_count",
            "number",
            "Estimated number of attendees at the event."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_other_facilities_on_site",
      "type": "Default",
      "data": {
        "name": "Ask Other Facilities On Site",
        "prompt": "Are there any other restroom or hand washing facilities already available at the event site?",
        "extractVars": [
          [
            "other_facilities_on_site",
            "boolean",
            "Whether other facilities are available on site. (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_number_of_stalls",
      "type": "Default",
      "data": {
        "name": "Ask Number of Stalls/Units",
        "prompt": "How many {{product_type | default: 'units'}} or stalls will be needed for the event? For trailers, you can specify stall count like '2 stalls' for a 2 Stall Restroom Trailer, or 'one 8 stall trailer' for an 8 Stall Restroom Trailer. If you need a specific type of trailer, please specify that as well.",
        "extractVars": [
          [
            "number_of_stalls_or_units_requested",
            "string",
            "User's request for number of stalls or units (e.g., '2 stalls', 'one 8 stall trailer', 'three porta potties')."
          ],
          [
            "trailer_type",
            "string",
            "Refine or confirm the specific product based on stall request. If user says '2 stalls' and product_type was 'Restroom Trailer', confirm as '2 Stall Restroom Trailer'. If they ask for a stall count not available (e.g. '5 stalls'), this variable might remain the general type, and the next node will handle alternatives. Available products: 1 Stall ADA Combo Trailer, 2 Stall Restroom Trailer, 3 Stall ADA Restroom Trailer, 4 Stall Restroom Trailer, 8 Stall Restroom Trailer, 10 Stall Restroom Trailer, 3 Stall Combo Trailer, 8 Stall Shower Trailer, Standard Porta Potty, ADA Porta Potty."
          ],
          [
            "stalls_exists",
            "boolean",
            "Check if stall with {{number_of_stalls_or_units_requested}} is available, Available products: 1 Stall ADA Combo Trailer, 2 Stall Restroom Trailer, 3 Stall ADA Restroom Trailer, 4 Stall Restroom Trailer, 8 Stall Restroom Trailer, 10 Stall Restroom Trailer, 3 Stall Combo Trailer, 8 Stall Shower Trailer, Standard Porta Potty, ADA Porta Potty."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_trailer_with_stalls_does_not_exist",
      "type": "Default",
      "data": {
        "name": "Trailer with Stalls Does Not Exist",
        "prompt": "Unfortunately, we don't have a trailer with exactly {{number_of_stalls_or_units_requested}} available. However, we can offer you options like our 1 Stall ADA Combo, 2 Stall Restroom, 3 Stall ADA Restroom, 4 Stall Restroom, 8 Stall Restroom, 10 Stall Restroom, 3 Stall Combo, or 8 Stall Shower Trailer. Would one of these, or perhaps a combination, work for you?",
        "extractVars": [
          [
            "trailer_type",
            "string",
            "List of available products that a user chooses, e.g., '1 Stall ADA Combo Trailer', '2 Stall Restroom Trailer'. Choose from the following: 1 Stall ADA Combo Trailer, 2 Stall Restroom Trailer, 3 Stall ADA Restroom Trailer, 4 Stall Restroom Trailer, 8 Stall Restroom Trailer, 10 Stall Restroom Trailer, 3 Stall Combo Trailer, 8 Stall Shower Trailer. ADA Trailers are compliant with the Americans with Disabilities Act."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_ada_required_event",
      "type": "Default",
      "data": {
        "name": "Ask if ADA Required (Event)",
        "prompt": "Will you have anyone there in a wheelchair or a walker? Do you need ADA (handicap accessible) facilities?",
        "extractVars": [
          [
            "ada_required",
            "boolean",
            "Whether ADA-compliant units are required for the event. (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "sa_ask_ada_product_selection_event",
      "type": "Default",
      "data": {
        "name": "Ask ADA Product Selection (Event)",
        "prompt": "Great! We have several ADA-compliant options available. Which would work best for your event: the 1 Stall ADA Combo Trailer, the 3 Stall ADA Restroom Trailer, or an ADA Porta Potty?",
        "extractVars": [
          [
            "preferred_ada_products",
            "string",
            "The preferred ADA products selected, e.g., '1 Stall ADA Combo Trailer', '3 Stall ADA Restroom Trailer', 'ADA Porta Potty'."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "ask_site_conditions_trailer",
      "type": "Default",
      "data": {
        "name": "Ask Site Conditions (Trailer)",
        "prompt": "Tell me about the delivery location for the {{trailer_type | default: 'trailer'}}. Are there any low overhanging trees or anything lower than 13 feet on the way to the placement location? Is the ground flat? And is it on cement, gravel, dirt, or grass?",
        "extractVars": [
          [
            "trailer_site_low_clearance",
            "boolean",
            "Are there low clearance issues (under 13ft)? (true/false)"
          ],
          [
            "trailer_site_is_flat",
            "boolean",
            "Is the placement area flat? (true/false)"
          ],
          [
            "trailer_site_surface_type",
            "string",
            "Surface type (cement, gravel, dirt, grass, other)."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "ask_duration_trailer",
      "type": "Default",
      "data": {
        "name": "Ask Rental Start Date (Trailer/General)",
        "prompt": "What is the ideal delivery date for the {{trailer_type | default: 'units'}}? We have an initial start date logged around {{request_data.event_start_date}}, which is a timestamp. Can you confirm the start date as Month Day, Year?",
        "extractVars": [
          [
            "rental_start_date",
            "string",
            "Ideal delivery date (YYYY-MM-DD). Confirm or update based on {{request_data.event_start_date}}."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "paq_ask_rental_days_trailer",
      "type": "Default",
      "data": {
        "name": "Ask Rental Days (Trailer/General)",
        "prompt": "And for how many days do you need the {{trailer_type | default: 'units'}} starting from {{rental_start_date}}? You can say days, weeks, or months. If you are unsure, please provide your best estimate. We may have an end date from your initial request as {{request_data.event_end_date}} (timestamp).",
        "extractVars": [
          [
            "rental_days",
            "number",
            "Number of rental days requested, convert the estimate to days, i.e 1 week = 7 days, 2 weeks = 14 days, 1 month = 30 days, etc."
          ],
          [
            "event_end_date",
            "string",
            "Calculated pickup date (YYYY-MM-DD), based on {{rental_start_date}} and {{rental_days}}. Or confirmed from {{request_data.event_end_date}} if user confirms it."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 50
        }
      }
    },
    {
      "id": "ask_power_trailer",
      "type": "Default",
      "data": {
        "name": "Ask Power (Trailer)",
        "prompt": "Do you have power available on-site for the {{trailer_type | default: 'trailer'}}? Typically, we need 1-3 dedicated 115 Volt, 15 Amp connections in non-freezing temperatures, or 2-4 in freezing temperatures.",
        "extractVars": [
          [
            "trailer_power_available",
            "boolean",
            "Is power available on-site? (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "power_available_ask_power_details",
      "type": "Default",
      "data": {
        "name": "Ask Power Details (Trailer - If Yes)",
        "prompt": "Okay. How far would you estimate the power source is from the {{trailer_type | default: 'trailer'}} placement? (e.g., less than 50feet, 50-100feet, 100-200feet, over 200feet). And would the power cord need to cross a walking or driving path? If so, do you want to rent cord ramps?",
        "extractVars": [
          [
            "trailer_power_distance",
            "string",
            "Estimated distance to power source."
          ],
          [
            "trailer_power_cord_cross_path",
            "boolean",
            "Does cord cross a path? (true/false)"
          ],
          [
            "trailer_wants_cord_ramps",
            "boolean",
            "Wants cord ramps? (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "power_not_available_ask_generator",
      "type": "Default",
      "data": {
        "name": "Ask Generator (Trailer - If No Power or Requested)",
        "prompt": "Since power isn't available (or if you prefer), would you like us to provide options for a generator? For usage less than 3 days, a 3kW or 7kW generator is often suitable. For longer usage or larger trailers, a 20kW or 30kW towable generator might be better. Our generator options are 3kW, 7kW, 20kW, and 30kW. Which type are you considering, if any?",
        "extractVars": [
          [
            "wants_generator",
            "boolean",
            "Wants generator options? (true/false)"
          ],
          [
            "generator_type_requested",
            "string",
            "Specific generator type if requested (e.g., '3kW Generator', '7kW Generator', '20kW Generator', '30kW Generator'). Please select from 3kW, 7kW, 20kW, 30kW or state none."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "ask_water_trailer",
      "type": "Default",
      "data": {
        "name": "Ask Water (Trailer)",
        "prompt": "Do you have water available on site for the {{trailer_type | default: 'trailer'}}? Our specialty trailers typically need one connection to a standard garden hose.",
        "extractVars": [
          [
            "trailer_water_available",
            "boolean",
            "Is water available on-site? (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "water_available_ask_water_details",
      "type": "Default",
      "data": {
        "name": "Ask Water Details (Trailer - If Yes)",
        "prompt": "Great. How far would you estimate the water source is from the {{trailer_type | default: 'trailer'}} placement? (e.g., less than 50feet, 50-100feet, 100-200feet, over 200feet). And would the hose need to cross a walking or driving path? If so, do you want to rent hose ramps?",
        "extractVars": [
          [
            "trailer_water_distance",
            "string",
            "Estimated distance to water source."
          ],
          [
            "trailer_water_hose_cross_path",
            "boolean",
            "Does hose cross a path? (true/false)"
          ],
          [
            "trailer_wants_hose_ramps",
            "boolean",
            "Wants hose ramps? (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "water_not_available_ask_water_service",
      "type": "Default",
      "data": {
        "name": "Recommend Water Service (Trailer - If No Water)",
        "prompt": "Since water isn't available on-site for the {{trailer_type | default: 'trailer'}}, we would recommend scheduling fresh water tank fills. Typically, one fill is needed per 3-5 hours of usage. Is this something you'd like to include?",
        "extractVars": [
          [
            "wants_water_fill_service",
            "boolean",
            "Wants fresh water fill service? (true/false)"
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "prepare_extras_for_api_node",
      "type": "Default",
      "data": {
        "name": "Prepare Extras List for API",
        "prompt": "Okay, I'm noting down the extras. Generator: {{generator_type_requested | default: 'N/A'}}. Other event services: {{other_products_needed_event | default: 'N/A'}}. Other construction services: {{other_products_needed_construction | default: 'N/A'}}. Water fill service: {{wants_water_fill_service | default: 'N/A'}}. This information will be used to form the extras list for the quote API.",
        "extractVars": [
          [
            "extras_list",
            "string",
            "Construct a JSON string representing an array for the 'extras' field for the quote API. Example: If generator_type_requested is '3kW Generator', include '{\"extra_id\": \"3kW Generator\", \"qty\": 1}'. If other_products_needed includes 'pump_out', add {'extra_id': 'pump_out', 'qty': 1}. If wants_water_fill_service is true, add {'extra_id': 'water_fill_service', 'qty': 1}. If no extras, use '[]'. Available generators for extra_id: 3kW Generator, 7kW Generator, 20kW Generator, 30kW Generator. Other common extra_ids: 'pump_out', 'cleaning', 'water_fill_service'. Format as JSON array string: e.g., '[{\"extra_id\": \"3kW Generator\", \"qty\": 1}]' or '[]' if no extras."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 50,
          "temperature": 0.2
        }
      }
    },
    {
      "id": "get_quote_webhook_node",
      "type": "Webhook",
      "data": {
        "name": "Get Quote (StahlaQuoteTool_v2)",
        "prompt": "Perfect! I have all the information needed. Let me calculate your customized quote right now.",
        "url": "https://nicely-thorough-monster.ngrok-free.app/api/v1/webhook/quote",
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer 7%FRtf@34hi"
        },
        "body": "{\"delivery_location\": \"{{delivery_location}}\", \"trailer_type\": \"{{trailer_type}}\", \"rental_start_date\": \"{{rental_start_date}}\", \"rental_days\": \"{{rental_days}}\", \"usage_type\": \"{{usage_type}}\", \"extras\": \"{{extras_list}}\", \"customer_details\": {\"name\": \"{{contact_name}}\", \"email\": \"{{contact_email}}\", \"phone\": \"{{phone_number}}\", \"company\": \"{{company_name}}\"}}",
        "timeout": 15,
        "retries": 2,
        "response_data": [
          {
            "name": "quote_api_success",
            "data": "$.success"
          },
          {
            "name": "quote_id",
            "data": "$.data.quote_id"
          },
          {
            "name": "estimated_total",
            "data": "$.data.quote.budget_details.estimated_total"
          },
          {
            "name": "line_items_summary",
            "data": "$.data.quote.line_items"
          },
          {
            "name": "quote_notes",
            "data": "$.data.quote.notes"
          },
          {
            "name": "delivery_cost",
            "data": "$.data.quote.delivery_details.total_delivery_cost"
          },
          {
            "name": "api_error_message",
            "data": "$.error_message"
          }
        ],
        "speechDuringWebhook": {
          "enabled": true,
          "text": "I'm calculating your personalized quote based on your requirements. This may take just a moment."
        },
        "afterWebhookPrompt": "Perfect! I've successfully generated your quote.",
        "pathwayRouting": [
          {
            "condition": "{{quote_api_success}} is true",
            "nextNode": "convey_quote_and_followup_offer_node"
          },
          {
            "condition": "{{quote_api_success}} is false",
            "nextNode": "api_error_quote_tool"
          },
          {
            "condition": "API Request Completion (Default)",
            "nextNode": "convey_quote_and_followup_offer_node"
          }
        ]
      }
    },
    {
      "id": "convey_quote_and_followup_offer_node",
      "type": "Default",
      "data": {
        "name": "Convey Quote & Inform Follow-up",
        "prompt": "Great! Here are your quote details: The estimated total is ${{estimated_total | default: 'being finalized'}}. Please note that this is an estimate, and we'll be sending a copy of the complete quote details to your email address at {{contact_email}}. One of our representatives will also follow up with you to discuss the details.",
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "api_error_quote_tool",
      "type": "Default",
      "data": {
        "name": "API Error Quote Tool",
        "prompt": "I'm sorry, there was an issue generating your quote right now. No worries though - our team has been notified and a representative will follow up with you shortly with the quote details.",
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "api_error_location_tool",
      "type": "Default",
      "data": {
        "name": "API Error Location Tool",
        "prompt": "I'm having a bit of trouble processing that address right now ({{api_error_message | default: 'technical issue'}}). Could you please confirm the full address again, including the city and state?",
        "extractVars": [
          [
            "delivery_location",
            "string",
            "The full delivery address provided by the user. Extract the complete address they provide, including street number, street name, city, state. Do not add 'null' or other placeholders."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "location_final_error_continue",
      "type": "Default",
      "data": {
        "name": "Location Verification Failed - Continue",
        "prompt": "I'm still having trouble verifying that specific address, but let's continue with your order requirements so we can still help you. What type of restroom or service are you looking for?",
        "extractVars": [],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "ask_final_questions",
      "type": "Default",
      "data": {
        "name": "Ask Final Questions",
        "prompt": "Before we wrap up, do you have any other questions for me right now about our services or the process?",
        "extractVars": [
          [
            "has_final_questions",
            "boolean",
            "Whether the user has final questions."
          ],
          [
            "final_questions_text",
            "string",
            "The text of any final questions asked."
          ]
        ],
        "modelOptions": {
          "interruptionThreshold": 100
        }
      }
    },
    {
      "id": "answer_final_question_kb",
      "type": "Knowledge Base",
      "data": {
        "name": "Answer Final Question from KB",
        "knowledgeBase": "Stahla Services (Stahla Rentals) - Knowledge Base\nSummary\nStahla Services, now known simply as Stahla, is a Nebraska-based, family-owned company specializing in luxury portable restroom and shower trailer rentals. Founded in 2014 by Grant and Erin Stahla, the company emphasizes hospitality, cleanliness, and a faith-driven commitment to customer care. Serving 17 states across the Midwest and Southwest, Stahla provides high-end sanitation solutions for events, construction sites, and emergency responses. Their trailers feature amenities like climate control, flushing toilets, and running water, aiming to offer a dignified and comfortable experience. With a focus on exceptional service and community values, Stahla has grown into a trusted provider in the portable sanitation industry.\nCompany Overview\nLegal Name: Stahla Services, LLC\nFounded: 2014\nFounders: Grant Stahla (CEO) & Erin Stahla (Co-Owner)\nCore Values: Family-run, faith-driven, customer-first service, Midwest work ethic\nServices Offered\nRestroom Trailer Rentals: Options range from 2-stall to 10-stall configurations. Examples: '2 Stall Restroom Trailer (Luxury)', '4 Stall Restroom Trailer (Standard)', '8 Stall Restroom Trailer (ADA Combo)'.\nADA Restroom Trailers: Fully compliant with Americans with Disabilities Act (ADA) standards. Include ramps, handrails, and spacious interiors.\nShower Trailer Rentals: Provide private, lockable shower stalls with hot water. Examples: '3 Stall Shower Trailer', '8 Stall Shower/Restroom Combo Trailer'.\nLaundry Trailer Rentals: Mobile units equipped with commercial-grade washers and dryers.\nPorta Potty Rentals: Standard, budget-friendly option. Available in basic, deluxe, or hand washing-equipped models. Includes ADA Porta Potty options.\nGenerator Rentals: Various sizes available, e.g., '3kW Generator', '7kW Generator'.\nOther Services: Holding tanks, fresh water delivery, regular servicing/pump-outs, cleaning.\nService Area\nServes 17 U.S. states: Arkansas (AR), Colorado (CO), Illinois (IL), Iowa (IA), Kansas (KS), Louisiana (LA), Minnesota (MN), Missouri (MO), Montana (MT), Nebraska (NE), New Mexico (NM), North Dakota (ND), Oklahoma (OK), South Dakota (SD), Texas (TX), Wisconsin (WI), Wyoming (WY)\nHeadquarters and Locations\nPrimary HQ: Omaha, Nebraska\nMain Address: 16902 South 180th Street, Suite 200, Springfield, NE 68059\nOther Office Locations:\nLincoln, NE – 420 W A St, Suite 200\nGretna, NE – 21824 Williams Circle\nSmithville, MO – 17609 HH Lake Road\nDenver, CO – 1340 Umatilla St\nContact Information\nPhone: (844) 900-3190\nEmail: [email protected]\nBusiness Hours:\nMon–Fri: 8 AM–5 PM\nSat: 8 AM–5 PM\nSun: Closed\nWebsite: https://stahla.com/\nProduct List (Examples - refer to full product sheet for all models):\n2 Stall Restroom Trailer (Luxury), 2 Stall Restroom Trailer (Standard), 3 Stall Restroom Trailer (Luxury), 4 Stall Restroom Trailer (Standard), 4 Stall Restroom Trailer (ADA Compliant), 5 Stall Restroom Trailer, 6 Stall Restroom Trailer, 8 Stall Restroom Trailer, 10 Stall Restroom Trailer, ADA Porta Potty, Standard Porta Potty, Deluxe Porta Potty, Hand wash Station (Porta Potty Addon), 3 Stall Shower Trailer, 8 Stall Shower Trailer, Laundry Trailer (8 Washer/Dryer), 3kW Generator, 7kW Generator.\nUsage Types for Quotes: event, commercial, construction, disaster_relief, other.",
        "prompt": "The user's question is: {{final_questions_text}}. Please answer based on the knowledge base.",
        "modelOptions": {
          "temperature": 0.5
        }
      }
    },
    {
      "id": "closing_with_followup_node",
      "type": "End Call",
      "data": {
        "name": "Closing with Follow-up Scheduled/Offered",
        "prompt": "Thank you for your time, {{contact_name}}! One of our representatives will be in touch with you soon. The quote information will be sent to {{contact_email}}. Have a great day! Goodbye."
      }
    },
    {
      "id": "end_call_speak_final",
      "type": "End Call",
      "data": {
        "name": "End Call Final",
        "prompt": "Thank you for calling Stahla Services. Goodbye!"
      }
    }
  ],
  "edges": [
    {
      "id": "edge_start_to_confirm_name",
      "source": "start_call",
      "target": "confirm_name",
      "label": "{{is_now_good_time}} is true"
    },
    {
      "id": "edge_start_to_ask_best_time",
      "source": "start_call",
      "target": "ask_best_time_to_call",
      "label": "{{is_now_good_time}} is false"
    },
    {
      "id": "edge_ask_best_time_to_end_reschedule",
      "source": "ask_best_time_to_call",
      "target": "end_call_reschedule",
      "label": "Callback time provided"
    },
    {
      "id": "edge_confirm_name_to_confirm_email",
      "source": "confirm_name",
      "target": "confirm_email",
      "label": "Name confirmed"
    },
    {
      "id": "edge_confirm_email_to_confirm_phone",
      "source": "confirm_email",
      "target": "confirm_phone",
      "label": "Email confirmed"
    },
    {
      "id": "edge_confirm_phone_to_confirm_company",
      "source": "confirm_phone",
      "target": "confirm_company",
      "label": "Phone confirmed"
    },
    {
      "id": "edge_confirm_company_to_confirm_address",
      "source": "confirm_company",
      "target": "confirm_address",
      "label": "Company name confirmed/collected"
    },
    {
      "id": "edge_confirm_address_to_delivery_address_type",
      "source": "confirm_address",
      "target": "delivery_address_type_node",
      "label": "Address confirmed/collected"
    },
    {
      "id": "edge_delivery_address_type_to_trigger_location_tool",
      "source": "delivery_address_type_node",
      "target": "trigger_background_location_processing_node",
      "label": "Delivery address type collected"
    },
    {
      "id": "edge_location_error_to_retry",
      "source": "api_error_location_tool",
      "target": "trigger_background_location_processing_node",
      "label": "User provides corrected address"
    },
    {
      "id": "edge_location_error_to_continue",
      "source": "api_error_location_tool",
      "target": "location_final_error_continue",
      "label": "Continue without location verification"
    },
    {
      "id": "edge_location_retry_error_to_continue",
      "source": "trigger_background_location_processing_node",
      "target": "location_final_error_continue",
      "label": "{{location_api_success}} is false and retry_attempt"
    },
    {
      "id": "edge_location_final_error_to_continue",
      "source": "location_final_error_continue",
      "target": "determine_order_category",
      "label": "Continue with order after location verification failed"
    },
    {
      "id": "edge_handle_oos_to_wants_referral",
      "source": "handle_out_of_service_area",
      "target": "wants_referral_node",
      "label": "{{offer_referral_consent}} is true"
    },
    {
      "id": "edge_handle_oos_to_no_referral",
      "source": "handle_out_of_service_area",
      "target": "no_referral_node",
      "label": "{{offer_referral_consent}} is false"
    },
    {
      "id": "edge_determine_order_cat_to_determine_prod_type",
      "source": "determine_order_category",
      "target": "determine_product_type",
      "label": "Order category determined"
    },
    {
      "id": "edge_determine_prod_type_to_event_flow_start",
      "source": "determine_product_type",
      "target": "sa_ask_event_duration_days",
      "label": "{{project_category}} contains Event"
    },
    {
      "id": "edge_determine_prod_type_to_construction_flow_start",
      "source": "determine_product_type",
      "target": "ask_site_conditions_trailer",
      "label": "{{project_category}} contains Construction or {{project_category}} contains Facility"
    },
    {
      "id": "edge_determine_prod_type_to_disaster_flow_start",
      "source": "determine_product_type",
      "target": "ask_site_conditions_trailer",
      "label": "{{project_category}} contains Disaster"
    },
    {
      "id": "edge_determine_prod_type_to_default_flow",
      "source": "determine_product_type",
      "target": "ask_site_conditions_trailer",
      "label": "Default flow for other categories"
    },
    {
      "id": "edge_sa_duration_to_total_hours",
      "source": "sa_ask_event_duration_days",
      "target": "sa_ask_total_hours",
      "label": "{{event_duration_days}} is 2 or more"
    },
    {
      "id": "edge_sa_duration_to_attendees_short_event",
      "source": "sa_ask_event_duration_days",
      "target": "sa_ask_attendees",
      "label": "{{event_duration_days}} is less than 2"
    },
    {
      "id": "edge_sa_total_hours_to_extra_services",
      "source": "sa_ask_total_hours",
      "target": "sa_discuss_extra_services_multi_day_long_hours",
      "label": "{{event_total_hours_a_day}} is 8 or more"
    },
    {
      "id": "edge_sa_total_hours_to_attendees_short_hours",
      "source": "sa_ask_total_hours",
      "target": "sa_ask_attendees",
      "label": "{{event_total_hours_a_day}} is less than 8"
    },
    {
      "id": "edge_sa_discuss_extra_services_to_ask_gaps",
      "source": "sa_discuss_extra_services_multi_day_long_hours",
      "target": "sa_ask_for_servicing_gaps",
      "label": "{{sa_accepts_discussion_extra_services}} is true"
    },
    {
      "id": "edge_sa_discuss_extra_services_skip_gaps_to_attendees",
      "source": "sa_discuss_extra_services_multi_day_long_hours",
      "target": "sa_ask_attendees",
      "label": "{{sa_accepts_discussion_extra_services}} is false"
    },
    {
      "id": "edge_sa_ask_gaps_to_attendees",
      "source": "sa_ask_for_servicing_gaps",
      "target": "sa_ask_attendees",
      "label": "Servicing gaps info collected"
    },
    {
      "id": "edge_sa_attendees_to_other_facilities",
      "source": "sa_ask_attendees",
      "target": "sa_ask_other_facilities_on_site",
      "label": "Attendees count collected"
    },
    {
      "id": "edge_sa_other_facilities_to_ask_stalls",
      "source": "sa_ask_other_facilities_on_site",
      "target": "sa_ask_number_of_stalls",
      "label": "Other facilities info collected"
    },
    {
      "id": "edge_sa_ask_stalls_to_ada_event",
      "source": "sa_ask_number_of_stalls",
      "target": "sa_ask_ada_required_event",
      "label": "{{stalls_exists}} is true"
    },
    {
      "id": "edge_sa_ask_stalls_to_stalls_not_exist",
      "source": "sa_ask_number_of_stalls",
      "target": "sa_trailer_with_stalls_does_not_exist",
      "label": "{{stalls_exists}} is false"
    },
    {
      "id": "edge_sa_stalls_not_exist_to_ada_event",
      "source": "sa_trailer_with_stalls_does_not_exist",
      "target": "sa_ask_ada_required_event",
      "label": "Alternative stall chosen"
    },
    {
      "id": "edge_sa_ada_required_yes_to_product_selection",
      "source": "sa_ask_ada_required_event",
      "target": "sa_ask_ada_product_selection_event",
      "label": "{{ada_required}} is true"
    },
    {
      "id": "edge_sa_ada_required_no_to_site_conditions",
      "source": "sa_ask_ada_required_event",
      "target": "ask_site_conditions_trailer",
      "label": "{{ada_required}} is false"
    },
    {
      "id": "edge_sa_ada_product_selection_to_site_conditions",
      "source": "sa_ask_ada_product_selection_event",
      "target": "ask_site_conditions_trailer",
      "label": "ADA product selected"
    },
    {
      "id": "edge_ask_site_conditions_to_ask_duration_trailer",
      "source": "ask_site_conditions_trailer",
      "target": "ask_duration_trailer",
      "label": "Site conditions collected"
    },
    {
      "id": "edge_ask_duration_trailer_to_ask_rental_days",
      "source": "ask_duration_trailer",
      "target": "paq_ask_rental_days_trailer",
      "label": "Start date collected"
    },
    {
      "id": "edge_paq_ask_rental_days_to_ask_power",
      "source": "paq_ask_rental_days_trailer",
      "target": "ask_power_trailer",
      "label": "Rental days collected"
    },
    {
      "id": "edge_ask_power_trailer_yes_to_details",
      "source": "ask_power_trailer",
      "target": "power_available_ask_power_details",
      "label": "{{trailer_power_available}} is true"
    },
    {
      "id": "edge_ask_power_trailer_no_to_generator",
      "source": "ask_power_trailer",
      "target": "power_not_available_ask_generator",
      "label": "{{trailer_power_available}} is false"
    },
    {
      "id": "edge_power_details_to_ask_water",
      "source": "power_available_ask_power_details",
      "target": "ask_water_trailer",
      "label": "Power details collected"
    },
    {
      "id": "edge_ask_generator_to_ask_water",
      "source": "power_not_available_ask_generator",
      "target": "ask_water_trailer",
      "label": "Generator info collected"
    },
    {
      "id": "edge_ask_water_trailer_yes_to_details",
      "source": "ask_water_trailer",
      "target": "water_available_ask_water_details",
      "label": "{{trailer_water_available}} is true"
    },
    {
      "id": "edge_ask_water_trailer_no_to_service",
      "source": "ask_water_trailer",
      "target": "water_not_available_ask_water_service",
      "label": "{{trailer_water_available}} is false"
    },
    {
      "id": "edge_water_details_to_prepare_extras",
      "source": "water_available_ask_water_details",
      "target": "prepare_extras_for_api_node",
      "label": "Water details collected"
    },
    {
      "id": "edge_water_service_to_prepare_extras",
      "source": "water_not_available_ask_water_service",
      "target": "prepare_extras_for_api_node",
      "label": "Water service info collected"
    },
    {
      "id": "edge_prepare_extras_to_get_quote",
      "source": "prepare_extras_for_api_node",
      "target": "get_quote_webhook_node",
      "label": "Extras prepared"
    },
    {
      "id": "edge_convey_quote_to_final_questions",
      "source": "convey_quote_and_followup_offer_node",
      "target": "ask_final_questions",
      "label": "Quote conveyed successfully"
    },
    {
      "id": "edge_api_error_to_final_questions",
      "source": "api_error_quote_tool",
      "target": "ask_final_questions",
      "label": "Quote error handled"
    },
    {
      "id": "edge_ask_final_q_yes",
      "source": "ask_final_questions",
      "target": "answer_final_question_kb",
      "label": "{{has_final_questions}} is true"
    },
    {
      "id": "edge_ask_final_q_no_to_closing",
      "source": "ask_final_questions",
      "target": "closing_with_followup_node",
      "label": "{{has_final_questions}} is false"
    },
    {
      "id": "edge_answer_kb_to_closing",
      "source": "answer_final_question_kb",
      "target": "closing_with_followup_node",
      "label": "Final question answered"
    }
  ]
}